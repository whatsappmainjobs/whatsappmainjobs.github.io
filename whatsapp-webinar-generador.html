<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generador Excel Webinar - 1000 Usuarios</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 text-gray-800 font-sans min-h-screen">
  <div class="max-w-4xl mx-auto p-6 space-y-6">
    <!-- Header -->
    <div class="bg-white shadow-xl rounded-2xl p-6">
      <h1 class="text-3xl font-bold text-center mb-4 text-green-700">
        üìä Generador Excel Webinar
      </h1>
      <p class="text-center text-gray-600 mb-6">
        Genera un archivo Excel con 1000 usuarios y f√≥rmulas autom√°ticas
      </p>

      <!-- Configuraci√≥n del webinar -->
      <div class="bg-blue-50 p-6 rounded-lg mb-6">
        <h2 class="text-xl font-bold mb-4 text-blue-800">‚öôÔ∏è Configuraci√≥n del Webinar</h2>
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block font-medium mb-2">üìÖ Fecha del webinar:</label>
            <input type="date" id="fechaWebinar" class="w-full border p-3 rounded-lg" />
          </div>
          <div>
            <label class="block font-medium mb-2">üïê Hora del webinar:</label>
            <input type="time" id="horaWebinar" value="20:00" class="w-full border p-3 rounded-lg" />
          </div>
          <div>
            <label class="block font-medium mb-2">üéØ Nombre del webinar:</label>
            <input type="text" id="nombreWebinar" placeholder="WEBINAR DE MARKETING DIGITAL" class="w-full border p-3 rounded-lg" />
          </div>
          <div>
            <label class="block font-medium mb-2">üåê URL del webinar:</label>
            <input type="text" id="urlWebinar" placeholder="https://teams.microsoft.com/meet/123456" class="w-full border p-3 rounded-lg" />
          </div>
          <div>
            <label class="block font-medium mb-2">üë• Filas para f√≥rmulas:</label>
            <select id="numFilas" class="w-full border p-3 rounded-lg">
              <option value="10">10 filas con f√≥rmulas</option>
              <option value="50">50 filas con f√≥rmulas</option>
              <option value="100" selected>100 filas con f√≥rmulas</option>
              <option value="500">500 filas con f√≥rmulas</option>
              <option value="1000">1000 filas con f√≥rmulas</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Vista previa de los datos -->
      <div class="bg-gray-50 p-4 rounded-lg mb-6">
        <h3 class="font-bold text-gray-800 mb-2">üìã Vista previa de la estructura:</h3>
        <div class="grid md:grid-cols-3 gap-4 text-sm">
          <div class="bg-white p-3 rounded border">
            <h4 class="font-semibold text-blue-600 mb-2">Hoja: Identificacion</h4>
            <ul class="space-y-1 text-gray-600">
              <li>‚Ä¢ NOMBRE</li>
              <li>‚Ä¢ APELLIDOS</li>
              <li>‚Ä¢ TELEFONO</li>
            </ul>
          </div>
          <div class="bg-white p-3 rounded border">
            <h4 class="font-semibold text-green-600 mb-2">Hoja: Datos</h4>
            <ul class="space-y-1 text-gray-600">
              <li>‚Ä¢ FECHA</li>
              <li>‚Ä¢ HORA</li>
              <li>‚Ä¢ NOMBRE WEBINAR</li>
              <li>‚Ä¢ URL</li>
              <li>‚Ä¢ NOMBRE COMPLETO (autom√°tico)</li>
              <li>‚Ä¢ TELEFONO FORMATEADO (autom√°tico)</li>
            </ul>
          </div>
          <div class="bg-white p-3 rounded border">
            <h4 class="font-semibold text-purple-600 mb-2">Hoja: Mensajes</h4>
            <ul class="space-y-1 text-gray-600">
              <li>‚Ä¢ Identificador</li>
              <li>‚Ä¢ Mensaje</li>
              <li>‚Ä¢ (Incluye plantillas)</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="max-w-md mx-auto">
        <button onclick="generarExcelPlantilla()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-4 rounded-lg text-lg font-bold transition-colors w-full">
          üìÑ Generar Excel Plantilla
        </button>
      </div>
    </div>

    <!-- Informaci√≥n -->
    <div class="bg-white shadow-xl rounded-2xl p-6">
      <h2 class="text-2xl font-bold mb-4 text-gray-700">‚ÑπÔ∏è Informaci√≥n importante</h2>
      <div class="space-y-4 text-gray-600">
        <div class="bg-green-50 p-4 rounded-lg">
          <h3 class="font-semibold text-green-800 mb-2">‚úÖ Datos que se rellenan autom√°ticamente:</h3>
          <ul class="space-y-1 text-sm">
            <li>‚Ä¢ <strong>FECHA:</strong> Se rellena en todas las filas con la fecha configurada</li>
            <li>‚Ä¢ <strong>HORA:</strong> Se rellena en todas las filas con la hora configurada</li>
            <li>‚Ä¢ <strong>NOMBRE WEBINAR:</strong> Se rellena en todas las filas con el nombre configurado</li>
            <li>‚Ä¢ <strong>URL:</strong> Se rellena en todas las filas con la URL configurada</li>
            <li>‚Ä¢ <strong>NOMBRE COMPLETO:</strong> F√≥rmula que combina NOMBRE + APELLIDOS</li>  
            <li>‚Ä¢ <strong>TELEFONO FORMATEADO:</strong> F√≥rmula que a√±ade el prefijo 34 si es necesario</li>
          </ul>
        </div>
        
        <div class="bg-blue-50 p-4 rounded-lg">
          <h3 class="font-semibold text-blue-800 mb-2">üìä Estructura generada:</h3>
          <ul class="space-y-1 text-sm">
            <li>‚Ä¢ <strong>Estructura completa:</strong> 3 hojas con encabezados correctos</li>
            <li>‚Ä¢ <strong>F√≥rmulas incluidas:</strong> Para NOMBRE COMPLETO y TELEFONO FORMATEADO</li>
            <li>‚Ä¢ <strong>Plantillas de mensajes:</strong> 4 mensajes predefinidos listos para usar</li>
            <li>‚Ä¢ <strong>Listo para completar:</strong> Solo tienes que a√±adir tus datos</li>
          </ul>
        </div>

        <div class="bg-yellow-50 p-4 rounded-lg">
          <h3 class="font-semibold text-yellow-800 mb-2">‚ö†Ô∏è Instrucciones de uso:</h3>
          <ol class="space-y-1 text-sm list-decimal list-inside">
            <li>Configura los datos del webinar arriba</li>
            <li>Selecciona cu√°ntas filas quieres preparar con f√≥rmulas</li>
            <li>Haz clic en "Generar Excel Plantilla"</li>
            <li>Abre el archivo en Excel y a√±ade tus datos en la hoja "Identificacion"</li>
            <li>Las columnas NOMBRE COMPLETO y TELEFONO FORMATEADO se llenar√°n autom√°ticamente</li>
            <li>Usa el archivo con el sistema de WhatsApp</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Log de actividad -->
    <div class="bg-white shadow-xl rounded-2xl p-6">
      <h2 class="text-xl font-bold mb-4 text-gray-700">üìù Registro de actividad</h2>
      <div id="logContent" class="text-sm text-gray-600 max-h-40 overflow-y-auto bg-gray-50 p-3 rounded-lg font-mono"></div>
    </div>
  </div>

<script>
// Variables y funciones b√°sicas
let libroExcel;

// Funci√≥n para formatear fecha
function formatearFecha(fecha) {
  const d = new Date(fecha);
  const dia = String(d.getDate()).padStart(2, '0');
  const mes = String(d.getMonth() + 1).padStart(2, '0');
  const a√±o = String(d.getFullYear()).slice(-2);
  return `${dia}/${mes}/${a√±o}`;
}

// Funci√≥n para generar Excel plantilla con f√≥rmulas
function generarExcelPlantilla() {
  const fechaWebinar = document.getElementById('fechaWebinar').value;
  const horaWebinar = document.getElementById('horaWebinar').value;
  const nombreWebinar = document.getElementById('nombreWebinar').value || 'WEBINAR DE MARKETING DIGITAL';
  const urlWebinar = document.getElementById('urlWebinar').value || 'https://teams.microsoft.com/meet/123456';
  const numFilas = parseInt(document.getElementById('numFilas').value);
  
  if (!fechaWebinar) {
    mostrarLog('‚ùå Por favor selecciona una fecha para el webinar', 'error');
    return;
  }
  
  mostrarLog(`üìÑ Generando plantilla Excel con ${numFilas} filas preparadas...`, 'info');
  
  const wb = XLSX.utils.book_new();
  
  // Hoja Identificacion vac√≠a pero con encabezados
  const identificacionData = [['NOMBRE', 'APELLIDOS', 'TELEFONO']];
  
  // A√±adir filas vac√≠as
  for (let i = 0; i < numFilas; i++) {
    identificacionData.push(['', '', '']);
  }
  
  const wsIdent = XLSX.utils.aoa_to_sheet(identificacionData);
  XLSX.utils.book_append_sheet(wb, wsIdent, 'Identificacion');
  
  // Hoja Datos con f√≥rmulas autom√°ticas y datos completados
  const datosData = [['FECHA', 'HORA', 'NOMBRE WEBINAR', 'URL', 'NOMBRE COMPLETO', 'TELEFONO FORMATEADO']];
  
  const fechaFormateada = formatearFecha(fechaWebinar);
  
  // Rellenar todas las filas con los datos del webinar y las f√≥rmulas
  for (let i = 2; i <= numFilas + 1; i++) {
    datosData.push([
      fechaFormateada,      // FECHA - rellenada en todas las filas
      horaWebinar,          // HORA - rellenada en todas las filas
      nombreWebinar,        // NOMBRE WEBINAR - rellenado en todas las filas  
      urlWebinar,           // URL - rellenada en todas las filas
      // F√≥rmula para NOMBRE COMPLETO
      { f: `Identificacion!A${i}&" "&Identificacion!B${i}` },
      // F√≥rmula para TELEFONO FORMATEADO
      { f: `IF(LEN(Identificacion!C${i})=9,IF(LEFT(Identificacion!C${i},2)="34",Identificacion!C${i},"34"&Identificacion!C${i}),Identificacion!C${i})` }
    ]);
  }
  
  const wsDatos = XLSX.utils.aoa_to_sheet(datosData);
  XLSX.utils.book_append_sheet(wb, wsDatos, 'Datos');
  
  // Hoja Mensajes con plantillas predefinidas - CORRECTAMENTE FORMATEADAS
  const mensajesData = [
    ['Identificador', 'Mensaje'],
    ['Recordatorio Webinar', `¬°Hola {Nombre}! üëã

Te recordamos que tienes programado el webinar:
üìÖ *{NOMBRE WEBINAR}*
üóìÔ∏è Fecha: {FECHA}
üïê Hora: {HORA}

üåê Accede aqu√≠: {URL}

¬°No te lo pierdas! üöÄ

¬øTienes alguna duda? ¬°Escr√≠benos!`],
    
    ['Confirmaci√≥n Asistencia', `¬°Hola {Nombre}! üëã

¬øConfirmas tu asistencia al webinar?
üìÖ *{NOMBRE WEBINAR}*
üóìÔ∏è {FECHA} a las {HORA}

üåê Enlace: {URL}

Responde "S√ç" para confirmar tu plaza.

¬°Te esperamos! üéØ`],
    
    ['Recordatorio Urgente', `üö® ¬°RECORDATORIO URGENTE! üö®

Hola {Nombre},

El webinar comienza en menos de 24 horas:
üìÖ *{NOMBRE WEBINAR}*
üóìÔ∏è {FECHA} - {HORA}

üåê ACCEDE AQU√ç: {URL}

‚è∞ ¬°No te quedes sin tu plaza!

Nos vemos ma√±ana üëã`],

    ['Mensaje de Prueba', `‚úÖ MENSAJE DE PRUEBA - TODAS LAS ETIQUETAS ‚úÖ

Hola {Nombre}! üëã

üìä DATOS PERSONALES:
‚Ä¢ Nombre completo: {NOMBRE COMPLETO}
‚Ä¢ Tel√©fono: {TELEFONO FORMATEADO}

üìö INFORMACI√ìN DEL WEBINAR:
‚Ä¢ Webinar: {NOMBRE WEBINAR}
‚Ä¢ URL: {URL}
‚Ä¢ Fecha: {FECHA}
‚Ä¢ Hora: {HORA}

‚úÖ Este mensaje muestra TODAS las etiquetas disponibles para verificar que funcionan correctamente.`]
  ];
  
  const wsMensajes = XLSX.utils.aoa_to_sheet(mensajesData);
  
  // Ajustar ancho de columnas para la hoja Mensajes
  wsMensajes['!cols'] = [
    { wch: 25 }, // Columna Identificador
    { wch: 80 }  // Columna Mensaje (m√°s ancha)
  ];
  
  XLSX.utils.book_append_sheet(wb, wsMensajes, 'Mensajes');
  
  // Descargar archivo
  const fecha = formatearFecha(fechaWebinar).replace(/\//g, '');
  const nombreArchivo = `Plantilla_WhatsApp_Webinar_${fecha}_${numFilas}filas.xlsx`;
  
  XLSX.writeFile(wb, nombreArchivo);
  
  mostrarLog(`‚úÖ Plantilla Excel generada: ${nombreArchivo}`, 'success');
  mostrarLog(`üìä ${numFilas} filas preparadas con datos del webinar completados`, 'info');
  mostrarLog(`üìã Fecha: ${fechaFormateada} | Hora: ${horaWebinar} | Webinar: ${nombreWebinar}`, 'info');
  mostrarLog(`üìù Incluye 4 plantillas de mensajes con formato correcto`, 'info');
}

// Funci√≥n para mostrar logs
function mostrarLog(mensaje, tipo = 'info') {
  const logDiv = document.getElementById('logContent');
  const timestamp = new Date().toLocaleTimeString('es-ES');
  
  let icono = '‚ÑπÔ∏è';
  let color = 'text-gray-600';
  
  switch (tipo) {
    case 'success':
      icono = '‚úÖ';
      color = 'text-green-600';
      break;
    case 'error':
      icono = '‚ùå';
      color = 'text-red-600';
      break;
    case 'warning':
      icono = '‚ö†Ô∏è';
      color = 'text-yellow-600';
      break;
  }
  
  const logEntry = document.createElement('div');
  logEntry.className = `mb-1 ${color}`;
  logEntry.innerHTML = `<span class="text-xs text-gray-500">[${timestamp}]</span> ${icono} ${mensaje}`;
  
  logDiv.appendChild(logEntry);
  logDiv.scrollTop = logDiv.scrollHeight;
}

// Inicializaci√≥n
document.addEventListener('DOMContentLoaded', function() {
  // Establecer fecha por defecto (ma√±ana)
  const ma√±ana = new Date();
  ma√±ana.setDate(ma√±ana.getDate() + 1);
  document.getElementById('fechaWebinar').value = ma√±ana.toISOString().split('T')[0];
  
  mostrarLog('üöÄ Generador de Excel iniciado', 'success');
  mostrarLog('üìã Configura los datos del webinar y genera tu archivo', 'info');
});
</script>

</body>
</html>